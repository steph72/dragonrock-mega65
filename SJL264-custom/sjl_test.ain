;-----------------------------------------------------------------------------
;---	SJL264 test data generator / checker
;-----------------------------------------------------------------------------
	cpu	6502
	page	0,0
;-----------------------------------------------------------------------------


tdstart_addr	=	$123c		;Start address
tdend_addr	=	$fadf		;End address

		php
		sei
		sta	$ff3f

		ldx	#(tdstart_addr & $ff)
		ldy	#(tdstart_addr / 256)
		stx	$d0
		sty	$d1

	IF (mode = "C")
		lda	#0
		sta	$d2
		sta	$d3
	ENDIF

		lda	#1
		sta	$e0

		ldy	#0

-		lda	$e0
	IF (mode = "G")
		sta	($d0),y
	ENDIF
	IF (mode = "C")
		cmp	($d0),y
		beq	+
		inc	$d2
		bne	+
		inc	$d3
+
	ENDIF
		inc	$d0
		bne	+
		inc	$d1
+
		lsr	$e0
		bcc	+
		lda	#%10111000
		eor	$e0
		sta	$e0
+
		lda	$d0
		cmp	#((tdend_addr + 1) & $ff)
		bne	-
		lda	$d1
		cmp	#((tdend_addr + 1) / 256)
		bne	-

	IF (mode = "C")
		ldx	$d2
		ldy	$d3
	ENDIF

		sta	$ff3e
		plp

;-----------------------------------------------------------------------------
